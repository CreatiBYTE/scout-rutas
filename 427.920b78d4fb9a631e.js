"use strict";(self.webpackChunkscout_rutas=self.webpackChunkscout_rutas||[]).push([[427],{9427:(A,g,i)=>{i.r(g),i.d(g,{MapaComponent:()=>N});var _=i(2881),P=i(5207),l=i(969),p=i(9417),f=i(6704),u=i(9978),m=i(8834),d=i(1224),n=i(1360),h=i(1114),E=i(2281),F=i(2392),b=i(695);const R=()=>({disableDefaultUI:!1,streetViewControl:!1}),v=()=>({strokeColor:"#2196f3",strokeOpacity:.8,strokeWeight:4}),I=(e,s)=>({lat:e,lng:s});function D(e,s){if(1&e&&(n.j41(0,"li"),n.EFF(1),n.k0s()),2&e){const a=s.$implicit;n.R7$(),n.JRh(a)}}function T(e,s){if(1&e){const a=n.RV6();n.qex(0),n.j41(1,"p",2),n.EFF(2,"Equipos:"),n.k0s(),n.j41(3,"ul"),n.DNE(4,D,2,1,"li",15),n.k0s(),n.j41(5,"button",11),n.bIt("click",function(){n.eBV(a);const t=n.XpG();return n.Njj(t.mostrarNombres=!t.mostrarNombres)}),n.EFF(6),n.k0s(),n.bVm()}if(2&e){const a=n.XpG();n.R7$(4),n.Y8G("ngForOf",a.ruta.equipos),n.R7$(2),n.SpI(" ",a.mostrarNombres?"Ocultar nombres":"Mostrar nombres"," ")}}function j(e,s){if(1&e){const a=n.RV6();n.j41(0,"div",16)(1,"p"),n.EFF(2,"Tu ruta no tiene puntos. Haz clic en "),n.j41(3,"strong"),n.EFF(4,'"Crear puntos"'),n.k0s(),n.EFF(5," para comenzar."),n.k0s(),n.j41(6,"button",17),n.bIt("click",function(){n.eBV(a);const t=n.XpG();return n.Njj(t.activarModoCreacion())}),n.EFF(7," Crear puntos "),n.k0s()()}}function k(e,s){1&e&&(n.j41(0,"div",18)(1,"p"),n.EFF(2,"Haz clic sobre el mapa para a\xf1adir cada punto de la ruta..."),n.k0s()())}function x(e,s){if(1&e){const a=n.RV6();n.j41(0,"div",22)(1,"mat-form-field",23)(2,"input",24),n.mxI("ngModelChange",function(t){const r=n.eBV(a).$implicit;return n.DH7(r.nombre,t)||(r.nombre=t),n.Njj(t)}),n.k0s()(),n.j41(3,"button",25),n.bIt("click",function(){const t=n.eBV(a).index,r=n.XpG(2);return n.Njj(r.eliminarPunto(t))}),n.j41(4,"mat-icon"),n.EFF(5,"delete"),n.k0s()()()}if(2&e){const a=s.$implicit;n.R7$(2),n.R50("ngModel",a.nombre)}}function B(e,s){if(1&e){const a=n.RV6();n.j41(0,"div",19)(1,"h3"),n.EFF(2,"Puntos de la ruta"),n.k0s(),n.DNE(3,x,6,1,"div",20),n.j41(4,"button",21),n.bIt("click",function(){n.eBV(a);const t=n.XpG();return n.Njj(t.guardarRuta())}),n.EFF(5,"Mi ruta est\xe1 lista, guardar"),n.k0s()()}if(2&e){const a=n.XpG();n.R7$(3),n.Y8G("ngForOf",a.puntos)}}function L(e,s){if(1&e&&n.nrm(0,"map-marker",26),2&e){const a=s.$implicit,o=n.XpG();n.Y8G("position",n.l_i(3,I,a.lat,a.lng))("label",o.mostrarNombres?a.nombre:"")("title",a.nombre)}}let N=(()=>{class e{router;rutasService;direccion="";mapaCentro={lat:20.7048,lng:-100.4431};zoom=14;puntos=[];ruta=null;mostrarNombres=!0;modoCreacion=!1;distanciaTotal=0;polylinePath=[];constructor(a,o){this.router=a,this.rutasService=o}ngOnInit(){const a=localStorage.getItem("rutaTemporal");a?this.ruta=JSON.parse(a):this.router.navigate(["/crear"])}buscarDireccion(){this.direccion.trim()&&(new google.maps.Geocoder).geocode({address:this.direccion},(o,t)=>{if("OK"===t&&o&&o[0]){const r=o[0].geometry.location;this.mapaCentro={lat:r.lat(),lng:r.lng()},this.zoom=16}else alert("No se pudo encontrar la direcci\xf3n.")})}activarModoCreacion(){this.modoCreacion=!0}agregarPunto(a){if(a.latLng){const o={lat:a.latLng.lat(),lng:a.latLng.lng(),nombre:`Punto ${this.puntos.length+1}`};this.puntos.push(o),this.polylinePath=this.puntos.map(t=>({lat:t.lat,lng:t.lng})),this.calcularDistanciaTotal()}}eliminarPunto(a){this.puntos.splice(a,1),this.calcularDistanciaTotal()}guardarRuta(){const a={...this.ruta,puntos:this.puntos,distanciaTotal:this.distanciaTotal};localStorage.setItem("rutaFinal",JSON.stringify(a)),this.rutasService.agregarRuta(a).then(()=>{alert("Ruta guardada correctamente."),this.router.navigate(["/rutas"])}).catch(o=>console.error("Error al guardar ruta",o))}calcularDistanciaTotal(){if(this.distanciaTotal=0,!(this.puntos.length<2))for(let a=1;a<this.puntos.length;a++){const o=this.puntos[a-1],t=this.puntos[a];this.distanciaTotal+=this.obtenerDistanciaEnKm(o.lat,o.lng,t.lat,t.lng)}}obtenerDistanciaEnKm(a,o,t,r){const M=this.gradosARadianes(t-a),C=this.gradosARadianes(r-o),O=Math.sin(M/2)*Math.sin(M/2)+Math.cos(this.gradosARadianes(a))*Math.cos(this.gradosARadianes(t))*Math.sin(C/2)*Math.sin(C/2);return 2*Math.atan2(Math.sqrt(O),Math.sqrt(1-O))*6371}gradosARadianes(a){return a*Math.PI/180}static \u0275fac=function(o){return new(o||e)(n.rXU(h.Ix),n.rXU(E.r))};static \u0275cmp=n.VBU({type:e,selectors:[["app-mapa"]],decls:29,vars:19,consts:[[1,"mapa-page"],[1,"datos-ruta"],[1,"muted"],[4,"ngIf"],["class","mensaje-inicial",4,"ngIf"],["class","mensaje-creacion",4,"ngIf"],["class","lista-puntos",4,"ngIf"],[1,"contenedor-mapa"],[1,"buscador-direccion"],["appearance","fill"],["matInput","","placeholder","Centrar mapa en...",3,"ngModelChange","ngModel"],["mat-stroked-button","","color","primary",3,"click"],["height","500px","width","100%",3,"mapClick","center","zoom","options"],[3,"path","options"],[3,"position","label","title",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"mensaje-inicial"],["mat-raised-button","","color","accent",3,"click"],[1,"mensaje-creacion"],[1,"lista-puntos"],["class","punto-item",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary",3,"click"],[1,"punto-item"],["appearance","outline"],["matInput","","placeholder","Nombre del punto",3,"ngModelChange","ngModel"],["mat-icon-button","","color","warn",3,"click"],[3,"position","label","title"]],template:function(o,t){1&o&&(n.j41(0,"div",0)(1,"div",1)(2,"h2"),n.EFF(3),n.k0s(),n.j41(4,"p",2),n.EFF(5,"Inicio:"),n.k0s(),n.j41(6,"p"),n.EFF(7),n.k0s(),n.j41(8,"p",2),n.EFF(9,"Fin:"),n.k0s(),n.j41(10,"p"),n.EFF(11),n.k0s(),n.j41(12,"p",2),n.EFF(13,"Distancia total:"),n.k0s(),n.j41(14,"p"),n.EFF(15),n.k0s(),n.DNE(16,T,7,2,"ng-container",3)(17,j,8,0,"div",4)(18,k,3,0,"div",5)(19,B,6,1,"div",6),n.k0s(),n.j41(20,"div",7)(21,"div",8)(22,"mat-form-field",9)(23,"input",10),n.mxI("ngModelChange",function(c){return n.DH7(t.direccion,c)||(t.direccion=c),c}),n.k0s()(),n.j41(24,"button",11),n.bIt("click",function(){return t.buscarDireccion()}),n.EFF(25,"Mostrar"),n.k0s()(),n.j41(26,"google-map",12),n.bIt("mapClick",function(c){return t.modoCreacion?t.agregarPunto(c):null}),n.nrm(27,"map-polyline",13),n.DNE(28,L,1,6,"map-marker",14),n.k0s()()()),2&o&&(n.R7$(3),n.JRh((null==t.ruta?null:t.ruta.nombre)||"Nueva Ruta"),n.R7$(4),n.Lme("",null==t.ruta?null:t.ruta.fechaInicio," ",null==t.ruta?null:t.ruta.horaInicio,""),n.R7$(4),n.Lme("",null==t.ruta?null:t.ruta.fechaFin," ",null==t.ruta?null:t.ruta.horaFin,""),n.R7$(4),n.SpI("",t.distanciaTotal.toFixed(2)," km"),n.R7$(),n.Y8G("ngIf",null==t.ruta?null:t.ruta.crearEquipos),n.R7$(),n.Y8G("ngIf",!t.puntos.length&&!t.modoCreacion),n.R7$(),n.Y8G("ngIf",t.modoCreacion&&!t.puntos.length),n.R7$(),n.Y8G("ngIf",t.puntos.length),n.R7$(4),n.R50("ngModel",t.direccion),n.R7$(3),n.Y8G("center",t.mapaCentro)("zoom",t.zoom)("options",n.lJ4(17,R)),n.R7$(),n.Y8G("path",t.polylinePath)("options",n.lJ4(18,v)),n.R7$(),n.Y8G("ngForOf",t.puntos))},dependencies:[_.MD,_.Sq,_.bT,P.iI,l.rJ,l.u6,l.fU,l.ZC,p.YN,p.me,p.BC,p.vS,f.M,F.j,u.fS,u.fg,m.Hl,m.$z,b.M,d.m_,d.An],styles:[".mapa-page[_ngcontent-%COMP%]{display:flex;gap:24px;padding:24px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]{width:35%;max-width:400px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin-top:0}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .muted[_ngcontent-%COMP%]{font-size:13px;color:#777;margin-bottom:0}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:4px;margin-bottom:12px;font-size:15px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-left:20px;margin-top:4px;margin-bottom:16px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .mensaje-inicial[_ngcontent-%COMP%], .mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .mensaje-creacion[_ngcontent-%COMP%]{background:#f5f5f5;padding:12px;border-left:4px solid #2196f3;border-radius:4px;margin-top:16px;font-size:14px;color:#444}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]{margin-top:20px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-bottom:12px}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]   .punto-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-bottom:.5rem}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]   .punto-item[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;margin:0}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]   .punto-item[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{cursor:pointer}.mapa-page[_ngcontent-%COMP%]   .datos-ruta[_ngcontent-%COMP%]   .lista-puntos[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:16px}.mapa-page[_ngcontent-%COMP%]   .contenedor-mapa[_ngcontent-%COMP%]{flex:1;border:2px solid #ccc;border-radius:8px;overflow:hidden;padding:12px}.mapa-page[_ngcontent-%COMP%]   .contenedor-mapa[_ngcontent-%COMP%]   .buscador-direccion[_ngcontent-%COMP%]{display:flex;gap:8px;align-items:center;margin-bottom:12px}.mapa-page[_ngcontent-%COMP%]   .contenedor-mapa[_ngcontent-%COMP%]   .buscador-direccion[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;margin:0}.mapa-page[_ngcontent-%COMP%]   .contenedor-mapa[_ngcontent-%COMP%]   .buscador-direccion[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{white-space:nowrap}.mapa-page[_ngcontent-%COMP%]   .contenedor-mapa[_ngcontent-%COMP%]   google-map[_ngcontent-%COMP%]{width:100%;height:500px}"]})}return e})()}}]);