"use strict";(self.webpackChunkscout_rutas=self.webpackChunkscout_rutas||[]).push([[79],{7079:(M,l,s)=>{s.r(l),s.d(l,{NavegarRutaComponent:()=>I});var c=s(2881),u=s(969),t=s(1360),d=s(1114),g=s(2281);const h=()=>({strokeColor:"#1976d2",strokeWeight:4});function v(e,o){1&e&&(t.j41(0,"div",2),t.EFF(1," Ruta inexistente, consulta con tu Scouter\n"),t.k0s())}function _(e,o){if(1&e&&(t.j41(0,"div",7)(1,"h1"),t.EFF(2),t.k0s(),t.j41(3,"p",8),t.EFF(4),t.k0s(),t.j41(5,"p",8),t.EFF(6),t.k0s(),t.j41(7,"h2"),t.EFF(8,"Scouts de M\xe9xico"),t.k0s(),t.nrm(9,"hr"),t.k0s()),2&e){const a=t.XpG(2);t.R7$(2),t.JRh(a.ruta.nombre),t.R7$(2),t.LHq("",a.ruta.fechaInicio," ",a.ruta.horaInicio," \u2192 ",a.ruta.fechaFin," ",a.ruta.horaFin,""),t.R7$(2),t.SpI("Distancia estimada: ",null==a.ruta.distanciaTotal?null:a.ruta.distanciaTotal.toFixed(2)," km")}}function m(e,o){if(1&e&&(t.j41(0,"div",9),t.EFF(1),t.k0s()),2&e){const a=t.XpG(2);t.R7$(),t.SpI(" Comienza en ",a.cuentaRegresiva," ")}}function p(e,o){1&e&&(t.j41(0,"div",9),t.EFF(1," EL evento ha concluido "),t.k0s())}function f(e,o){1&e&&(t.j41(0,"p"),t.EFF(1,'Agrega esta p\xe1gina a tu inicio desde el men\xfa \u22ee y elige "Agregar a pantalla principal".'),t.k0s())}function E(e,o){1&e&&(t.j41(0,"p"),t.EFF(1,'Presiona el bot\xf3n "Compartir" y selecciona "Agregar a inicio".'),t.k0s())}function R(e,o){if(1&e&&(t.j41(0,"div",10),t.qex(1,11),t.DNE(2,f,2,0,"p",12)(3,E,2,0,"p",12),t.bVm(),t.k0s()),2&e){const a=t.XpG(2);t.R7$(),t.Y8G("ngSwitch",a.navegador),t.R7$(),t.Y8G("ngSwitchCase","chrome"),t.R7$(),t.Y8G("ngSwitchCase","safari")}}function C(e,o){if(1&e&&(t.j41(0,"google-map",13),t.nrm(1,"map-polyline",14),t.k0s()),2&e){const a=t.XpG(2);t.Y8G("center",a.mapaCentro)("zoom",a.zoom),t.R7$(),t.Y8G("path",a.polylinePath)("options",t.lJ4(4,h))}}function x(e,o){if(1&e&&(t.j41(0,"div"),t.DNE(1,_,10,6,"div",3)(2,m,2,1,"div",4)(3,p,2,0,"div",4)(4,R,4,3,"div",5)(5,C,2,5,"google-map",6),t.k0s()),2&e){const a=t.XpG();t.R7$(),t.Y8G("ngIf",a.ruta),t.R7$(),t.Y8G("ngIf","no-iniciado"===a.eventoEstado),t.R7$(),t.Y8G("ngIf","finalizado"===a.eventoEstado),t.R7$(),t.Y8G("ngIf","en-curso"===a.eventoEstado&&!a.instalada),t.R7$(),t.Y8G("ngIf",a.instalada)}}let I=(()=>{class e{route;rutasService;puntos=[];mapaCentro={lat:20.6205,lng:-100.4483};zoom=15;idRuta="";ruta=null;rutaNoExiste=!1;eventoEstado=null;cuentaRegresiva="";navegador="otro";instalada=!1;timer;constructor(a,n){this.route=a,this.rutasService=n,this.detectarNavegador(),this.instalada=this.isStandalone(),this.route.paramMap.subscribe(i=>{this.idRuta=i.get("id")||"",this.idRuta?this.rutasService.obtenerRutaPorId(this.idRuta).subscribe(r=>{r?(this.ruta=r,r.puntos&&(this.puntos=r.puntos,this.puntos.length&&(this.mapaCentro={lat:this.puntos[0].lat,lng:this.puntos[0].lng})),this.actualizarEstadoEvento(),this.instalada&&this.guardarEnLocalStorage()):this.rutaNoExiste=!0}):this.rutaNoExiste=!0})}get polylinePath(){return this.puntos.map(a=>({lat:a.lat,lng:a.lng}))}detectarNavegador(){const a=navigator.userAgent;/Chrome/i.test(a)?this.navegador="chrome":/Safari/i.test(a)&&(this.navegador="safari")}actualizarEstadoEvento(){if(!this.ruta)return;const a=new Date(`${this.ruta.fechaInicio}T${this.ruta.horaInicio}`),n=new Date(`${this.ruta.fechaFin}T${this.ruta.horaFin}`),i=new Date;i<a?(this.eventoEstado="no-iniciado",this.iniciarCuentaRegresiva(a)):this.eventoEstado=i>n?"finalizado":"en-curso"}iniciarCuentaRegresiva(a){this.actualizarCuentaRegresiva(a),this.timer=setInterval(()=>this.actualizarCuentaRegresiva(a),1e3)}actualizarCuentaRegresiva(a){const n=a.getTime()-Date.now();if(n<=0)return this.cuentaRegresiva="00:00:00",this.timer&&clearInterval(this.timer),void this.actualizarEstadoEvento();const i=Math.floor(n/36e5),r=Math.floor(n%36e5/6e4),F=Math.floor(n%6e4/1e3);this.cuentaRegresiva=[i,r,F].map(N=>N.toString().padStart(2,"0")).join(":")}isStandalone(){return window.matchMedia("(display-mode: standalone)").matches||navigator.standalone}guardarEnLocalStorage(){this.ruta&&localStorage.setItem(`ruta-${this.idRuta}`,JSON.stringify(this.ruta))}ngOnDestroy(){this.timer&&clearInterval(this.timer)}static \u0275fac=function(n){return new(n||e)(t.rXU(d.nX),t.rXU(g.r))};static \u0275cmp=t.VBU({type:e,selectors:[["app-navegar-ruta"]],decls:2,vars:2,consts:[["class","ruta-no-existe",4,"ngIf"],[4,"ngIf"],[1,"ruta-no-existe"],["class","ruta-header",4,"ngIf"],["class","contador",4,"ngIf"],["class","instrucciones",4,"ngIf"],["height","100vh","width","100%",3,"center","zoom",4,"ngIf"],[1,"ruta-header"],[1,"texto-muted"],[1,"contador"],[1,"instrucciones"],[3,"ngSwitch"],[4,"ngSwitchCase"],["height","100vh","width","100%",3,"center","zoom"],[3,"path","options"]],template:function(n,i){1&n&&t.DNE(0,v,2,0,"div",0)(1,x,6,5,"div",1),2&n&&(t.Y8G("ngIf",i.rutaNoExiste),t.R7$(),t.Y8G("ngIf",!i.rutaNoExiste))},dependencies:[c.MD,c.bT,c.ux,c.e1,u.rJ,u.u6,u.ZC],styles:[".ruta-header[_ngcontent-%COMP%]{padding:1rem;text-align:center}.texto-muted[_ngcontent-%COMP%]{color:#666;margin:.25rem 0}.contador[_ngcontent-%COMP%], .instrucciones[_ngcontent-%COMP%], .ruta-no-existe[_ngcontent-%COMP%]{text-align:center;padding:.5rem 1rem;font-weight:700}"]})}return e})()}}]);